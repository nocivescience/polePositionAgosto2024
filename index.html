<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carretera en movimiento</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Para evitar que la carretera se desplace fuera de la pantalla */
        }

        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            perspective: 500px; /* Distancia de visualización para la perspectiva */
        }

        .road {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 80vw;
            height: 200vh; /* Aumenta la altura para que se vea un largo tramo de carretera */
            transform: translateX(-50%) rotateX(45deg); /* Aplicando perspectiva */
            background: repeating-linear-gradient(
                0deg,
                #333,
                #333 16px,
                #fff 110px,
                #fff 20px
            );
            animation: move 5s linear infinite;
            transform-origin: bottom;
            transition: transform 2s ease; /* Agrega transición suave */
        }

        .car {
            position: absolute;
            width: 40px;
            height: 80px;
            background: red;
            top: 75%; /* Posición del coche en la carretera */
            left: calc(50% - 20px); /* Centrar el coche */
            transform: translateX(-50%) rotateX(45deg); /* Aplicar perspectiva */
        }

        .competitor {
            position: absolute;
            width: 40px;
            height: 80px;
            top: 0;
            transform: rotateX(45deg);
        }

        .wheel {
            position: absolute;
            width: 15px;
            height: 15px;
            background: black;
            border-radius: 7%;
        }

        .wheel.front-left {
            bottom: 5px;
            left: 42px;
        }

        .wheel.front-right {
            bottom: 5px;
            right: 42px;
        }

        .wheel.back-left {
            top: 5px;
            left: 42px;
        }

        .wheel.back-right {
            top: 5px;
            right: 42px;
        }

        @keyframes move {
            100% {
                background-position: 0 2000px;
            }
        }
        .smoke {
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            animation: smoke 1s linear infinite;
            filter: blur(4px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="road"></div>
        <div class="car">
            <div class="wheel front-left"></div>
            <div class="wheel front-right"></div>
            <div class="wheel back-left"></div>
            <div class="wheel back-right"></div>
        </div>
    </div>
    <script>
        const music = new Audio('music.mp3');
        class Car {
            constructor(element) {
                this.element = element;
                this.x = window.innerWidth / 2; // Colocar el coche en el centro inicial
                this.speed = 10; // Velocidad constante
                this.direction = 0; // Dirección inicial (0 = sin movimiento)
                this.roadWidth = document.querySelector('.road').offsetWidth; // Ancho de la carretera
                this.carWidth = this.element.offsetWidth; // Ancho del coche
                this.wheelFrontLeft = this.element.querySelector('.front-left');
                this.wheelFrontRight = this.element.querySelector('.front-right');
                this.wheelBackLeft = this.element.querySelector('.back-left');
                this.wheelBackRight = this.element.querySelector('.back-right');
            }

            smoke() {
                const smoke = document.createElement('div');
                smoke.className = 'smoke';
                smoke.style.left = this.x;
                smoke.style.bottom = this.element.offsetHeight / 2 -70+ 'px';
                this.element.appendChild(smoke);
                setTimeout(() => {
                    smoke.remove();
                }, 1000);
            }

            move() {
                this.x += this.direction * this.speed;
                const roadLeftBound = (window.innerWidth - this.roadWidth) / 2 + 180;
                const roadRightBound = roadLeftBound + this.roadWidth - 320;

                // Limitar movimiento para que no se salga de la carretera
                if (this.x < roadLeftBound) {
                    this.x = roadLeftBound;
                }
                if (this.x + this.carWidth > roadRightBound) {
                    this.x = roadRightBound - this.carWidth;
                }

                this.element.style.left = this.x + 'px';

                // Vibración de las ruedas
                this.wheelFrontLeft.style.bottom = 5 + Math.random() * 10 + 'px';
                this.wheelFrontRight.style.bottom = 5 + Math.random() * 10 + 'px';
                this.wheelBackLeft.style.top = 5 + Math.random() * 10 + 'px';
                this.wheelBackRight.style.top = 5 + Math.random() * 10 + 'px';
                this.smoke();
            }

            getRect() {
                return this.element.getBoundingClientRect();
            }
        }

        class Competitor {
            constructor(container) {
                this.x = Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1;
                this.y = -100;
                this.speed = 5;
                this.element = document.createElement('div');
                this.element.className = 'competitor';
                this.element.style.left = this.x + 'px';
                container.appendChild(this.element);
                this.colors = ['blue', 'green', 'yellow', 'purple', 'orange', 'pink'];
                this.color= this.colors[Math.floor(Math.random() * this.colors.length)];
                this.element.style.backgroundColor = this.color;
            }

            move() {
                this.y += this.speed;
                this.element.style.top = this.y + 'px';
            }

            getRect() {
                return this.element.getBoundingClientRect();
            }
        }

        const carElement = document.querySelector('.car');
        const car = new Car(carElement);
        const container = document.querySelector('.container');
        let competitors = [];
        let gameInterval;

        document.addEventListener('keydown', (event) => {
            if (event.key === 'd') {
                car.direction = 1;
            } else if (event.key === 'a') {
                car.direction = -1;
            }
            if(event.key === 'm'){
                music.play();
                music.loop = true;
                music.volume = 0.06;
            }
        });

        document.addEventListener('keyup', (event) => {
            if (event.key === 'd' || event.key === 'a') {
                car.direction = 0; // Detener el movimiento cuando se suelta la tecla
            }
        });

        function checkCollision(rect1, rect2) {
            return !(rect1.right < rect2.left ||
                     rect1.left > rect2.right ||
                     rect1.bottom < rect2.top ||
                     rect1.top > rect2.bottom);
        }

        function endGame() {
            clearInterval(gameInterval);
            alert('¡Juego terminado!');
            music.pause();
        }

        function gameLoop() {
            car.move();

            // Mover y generar competidores
            if (Math.random() < 0.02) {
                competitors.push(new Competitor(container));
            }

            competitors.forEach((competitor, index) => {
                competitor.move();
                if (checkCollision(car.getRect(), competitor.getRect())) {
                    endGame();
                }
                if (competitor.y > window.innerHeight) {
                    competitor.element.remove();
                    competitors.splice(index, 1);
                }
            });
        }

        gameInterval = setInterval(gameLoop, 1000 / 60); // 60 FPS
    </script>
</body>
</html>